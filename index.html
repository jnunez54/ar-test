<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Aprendizaje transmedia</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            z-index: 1000;
            text-align: center;
        }
        #marker-status {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .marker-indicator {
            padding: 5px 10px;
            border-radius: 4px;
            background: #333;
            font-size: 12px;
        }
        .marker-active {
            background: #4CAF50;
        }
        #instructions {
            position: fixed;
            bottom: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            color: white;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            z-index: 1000;
        }
    </style>
</head>

<body>
    <div id="ui-overlay">
        <h2>Aprendizaje transmedia</h2>
        <div id="marker-status">
            <div class="marker-indicator" id="marker1-status">¿Qué es?</div>
            <div class="marker-indicator" id="marker2-status">Metaverso</div>
            <div class="marker-indicator" id="marker3-status">Simulación</div>
            <div class="marker-indicator" id="marker4-status">Desafíos</div>
            <div class="marker-indicator" id="markerA-status">Ejemplo A</div>
            <div class="marker-indicator" id="markerB-status">Ejemplo B</div>
        </div>
    </div>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
        <a-assets>
            <!-- Imágenes -->
            <img id="img1" src="imgs/1.png">
            <img id="img2" src="imgs/2.png">
            <img id="img3" src="imgs/3.png">
            <img id="img4" src="imgs/4.png">

            <!-- Audios -->
            <audio id="audio1" src="audio/1.mp3"></audio>
            <audio id="audio2" src="audio/2.mp3"></audio>
            <audio id="audio3" src="audio/3.mp3"></audio>
            <audio id="audio4" src="audio/4.mp3"></audio>
            <audio id="audioA" src="audio/a.mp3"></audio>
            <audio id="audioB" src="audio/b.mp3"></audio>

            <!-- Modelos 3D -->
            <a-asset-item id="charModel" src="models/fox.gltf"></a-asset-item>
            <a-asset-item id="budaModel" src="models/buda.gltf"></a-asset-item>
            <a-asset-item id="organModel" src="models/organ.gltf"></a-asset-item>
        </a-assets>

        <!-- Marker 1 -->
        <a-marker id="marker1" type="pattern" url="markers/1.patt">
            <a-plane
                src="#img1"
                width="1.5"
                height="1.5"
                position="-.75 1 0"
                rotation="0 0 0">
            </a-plane>

            <a-entity
                id="model1"
                gltf-model="#charModel"
                position="0.75 0.5 0"
                rotation="-90 0 0"
                scale="0.5 0.5 0.5"
                animation-mixer>
            </a-entity>
        </a-marker>

        <!-- Marker 2 -->
        <a-marker id="marker2" type="pattern" url="markers/2.patt">
            <a-plane
                src="#img2"
                width="1.5"
                height="1.5"
                position="-.75 1 0"
                rotation="0 0 0">
            </a-plane>

            <a-entity
                id="model2"
                gltf-model="#charModel"
                position="0.75 0.5 0"
                rotation="-90 0 0"
                scale="0.5 0.5 0.5"
                animation-mixer>
            </a-entity>
        </a-marker>

        <!-- Marker 3 -->
        <a-marker id="marker3" type="pattern" url="markers/3.patt">
            <a-plane
                src="#img3"
                width="1.5"
                height="1.5"
                position="-.75 1 0"
                rotation="0 0 0">
            </a-plane>

            <a-entity
                id="model3"
                gltf-model="#charModel"
                position="0.75 0.5 0"
                rotation="-90 0 0"
                scale="0.5 0.5 0.5"
                animation-mixer>
            </a-entity>
        </a-marker>

        <!-- Marker 4 -->
        <a-marker id="marker4" type="pattern" url="markers/4.patt">
            <a-plane
                src="#img4"
                width="1.5"
                height="1.5"
                position="-.75 1 0"
                rotation="0 0 0">
            </a-plane>

            <a-entity
                id="model4"
                gltf-model="#charModel"
                position="0.75 0.5 0"
                rotation="-90 0 0"
                scale="0.5 0.5 0.5"
                animation-mixer>
            </a-entity>
        </a-marker>

        <!-- Marker A (con zorro y buda) -->
        <a-marker id="markerA" type="pattern" url="markers/A.patt">
            
            <a-entity
                id="modelA1"
                gltf-model="#charModel"
                position="-0.5 0.5 0"
                rotation="-90 0 0"
                scale="0.3 0.3 0.3"
                animation-mixer>
            </a-entity>
            
            <a-entity
                id="modelA2"
                gltf-model="#budaModel"
                position="0.5 0.75 0"
                rotation="0 0 0"
                scale=".5 .5 .5"
                animation-mixer>
            </a-entity>
        </a-marker>

        <!-- Marker B (con zorro y órgano) -->
        <a-marker id="markerB" type="pattern" url="markers/B.patt">
            
            <a-entity
                id="modelB1"
                gltf-model="#charModel"
                position="-0.25 0.5 0"
                rotation="-90 0 0"
                scale=".3 .3 .3"
                animation-mixer>
            </a-entity>
            
            <a-entity
                id="modelB2"
                gltf-model="#organModel"
                position="0.5 0.75 0"
                rotation="0 0 0"
                scale="0.75 0.75 0.75"
                animation-mixer>
            </a-entity>
        </a-marker>

        <!-- Cámara -->
        <a-entity camera></a-entity>
    </a-scene>

    <div id="instructions">
        Muestra los marcadores frente a la cámara para activar los modelos 3D y el audio (El teléfono debe estar en vertical y el marcador horizontal, en caso de que el modelo no se vea, actualizar la página con el teléfono y el marcador en la posición mencionada)
    </div>

    <script>
        // Configuración optimizada para todos los marcadores
        document.addEventListener('DOMContentLoaded', () => {
            // Configurar para cada marcador 1-4
            for (let i = 1; i <= 4; i++) {
                const marker = document.querySelector(`#marker${i}`);
                const audio = document.querySelector(`#audio${i}`);
                const statusIndicator = document.querySelector(`#marker${i}-status`);

                let isPlaying = false;

                marker.addEventListener('markerFound', () => {
                    console.log(`Marker ${i} detectado`);
                    statusIndicator.classList.add('marker-active');
                    
                    if (!isPlaying) {
                        audio.currentTime = 0;
                        audio.play().catch(err => {
                            console.warn(`No se pudo reproducir el audio ${i}:`, err);
                        });
                        isPlaying = true;
                    }
                });

                marker.addEventListener('markerLost', () => {
                    console.log(`Marker ${i} perdido`);
                    statusIndicator.classList.remove('marker-active');
                    audio.pause();
                    audio.currentTime = 0;
                    isPlaying = false;
                });
            }

            // Configurar para marcadores A y B (con dos modelos cada uno)
            const markersAB = [
                { id: 'A', audioId: 'audioA', models: ['modelA1', 'modelA2'] },
                { id: 'B', audioId: 'audioB', models: ['modelB1', 'modelB2'] }
            ];

            markersAB.forEach(markerConfig => {
                const marker = document.querySelector(`#marker${markerConfig.id}`);
                const audio = document.querySelector(`#${markerConfig.audioId}`);
                const statusIndicator = document.querySelector(`#marker${markerConfig.id}-status`);

                let isPlaying = false;

                marker.addEventListener('markerFound', () => {
                    console.log(`Marker ${markerConfig.id} detectado`);
                    statusIndicator.classList.add('marker-active');
                    
                    // Mostrar ambos modelos
                    markerConfig.models.forEach(modelId => {
                        const model = document.querySelector(`#${modelId}`);
                        if (model) {
                            model.setAttribute('visible', 'true');
                        }
                    });
                    
                    if (!isPlaying) {
                        audio.currentTime = 0;
                        audio.play().catch(err => {
                            console.warn(`No se pudo reproducir el audio ${markerConfig.id}:`, err);
                        });
                        isPlaying = true;
                    }
                });

                marker.addEventListener('markerLost', () => {
                    console.log(`Marker ${markerConfig.id} perdido`);
                    statusIndicator.classList.remove('marker-active');
                    
                    // Ocultar ambos modelos
                    markerConfig.models.forEach(modelId => {
                        const model = document.querySelector(`#${modelId}`);
                        if (model) {
                            model.setAttribute('visible', 'false');
                        }
                    });
                    
                    audio.pause();
                    audio.currentTime = 0;
                    isPlaying = false;
                });
            });
        });
    </script>
</body>
</html>